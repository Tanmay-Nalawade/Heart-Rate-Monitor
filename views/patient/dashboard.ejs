<% layout('layouts/bootstrap')%>
<div class="d-flex justify-content-between align-items-center mb-4">
  <h1 class="text-primary">Hi there, <b><%= currentUser.name %>!</b></h1>

  <a href="/patient/device/new" class="ml-auto">
    <button type="button" class="btn btn-success btn-lg">
      Add a New Device
    </button>
  </a>
</div>

<hr />

<div class="mb-5">
  <h2 class="text-secondary mb-3">
    <i class="fas fa-user-md me-2"></i>Your Physicians
  </h2>

  <% if (currentUser.assignedPhysicians && currentUser.assignedPhysicians.length > 0) { %>
    <div class="row row-cols-1 row-cols-md-2 g-3 mb-4">
      <% for (let physician of currentUser.assignedPhysicians) { %>
        <div class="col">
          <div class="card shadow-sm h-100">
            <div class="card-body d-flex flex-column">
              <img src="<%= physician.image %>" alt="<%= physician.name %>" style="max-width: 150px; height: auto; object-fit: cover; border-radius: 8px; margin-bottom: 10px;">
              <h5 class="card-title text-primary"><%= physician.name %></h5>
              <p class="card-text text-muted small">
                <strong>License ID:</strong> <%= physician.licenseId %>
              </p>
              <p class="card-text text-muted small">
                <strong>Location:</strong> <%= physician.location %>
              </p>
              <p class="card-text"><%= physician.description %></p>
              <form method="POST" action="/patient/remove-physician/<%= physician._id %>" style="margin-top: auto;">
                <button type="submit" class="btn btn-sm btn-danger">Remove Physician</button>
              </form>
            </div>
          </div>
        </div>
      <% } %>
    </div>
  <% } else { %>
    <div class="alert alert-info">
      <i class="fas fa-info-circle me-2"></i>You have not assigned any physicians yet.
    </div>
  <% } %>

  <details class="mb-4">
    <summary class="btn btn-outline-primary">Browse Available Physicians</summary>
    <div class="mt-3">
      <% if (availablePhysicians && availablePhysicians.length > 0) { %>
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3">
          <% for (let physician of availablePhysicians) { %>
            <div class="col">
              <div class="card shadow-sm h-100">
                <div class="card-body d-flex flex-column">
                  <img src="<%= physician.image %>" alt="<%= physician.name %>" style="max-width: 150px; height: auto; object-fit: cover; border-radius: 8px; margin-bottom: 10px;">
                  <h5 class="card-title text-primary"><%= physician.name %></h5>
                  <p class="card-text text-muted small">
                    <strong>License ID:</strong> <%= physician.licenseId %>
                  </p>
                  <p class="card-text text-muted small">
                    <strong>Location:</strong> <%= physician.location %>
                  </p>
                  <p class="card-text"><%= physician.description %></p>
                  <form method="POST" action="/patient/choose-physician/<%= physician._id %>" style="margin-top: auto;">
                    <button type="submit" class="btn btn-sm btn-primary w-100">Choose Physician</button>
                  </form>
                </div>
              </div>
            </div>
          <% } %>
        </div>
      <% } else { %>
        <p class="text-muted">No physicians available.</p>
      <% } %>
    </div>
  </details>
</div>

<hr />

<h2 class="text-secondary mb-3">
  <i class="fas fa-heartbeat me-2"></i>Your Devices
</h2>
<% for (let device of patient_devices){%>
<div class="card" style="margin: 20px 0">
  <div class="card-header">
    Data readings are taken every
    <b><%= device.measurementConfig.frequencyMinutes %></b> minutes.
  </div>
  <div class="card-body">
    <h5 class="card-title"><%= device.label %></h5>
    <p class="card-text">
      Device ID: <%= device.hardwareId %>
      <br />
      Model: <%= device.model %>
    </p>

    <a href="/patient/readings/<%= device._id %>" class="btn btn-primary"
      >View Data</a
    >

    <a href="/patient/device/<%= device._id %>/edit" class="btn btn-secondary"
      >Edit Device Settings</a
    >
  </div>
</div>
<% }%>
